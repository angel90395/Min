<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>çš®å…‹æ•æ”¶æœç¨®èŠ±è·¯å¾‘ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; overflow-x: hidden; }
        body { display: flex; flex-direction: column; font-family: -apple-system, "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background: #f0f4f8; }

        /* å…¬ä½ˆæ¬„èˆ‡ç”Ÿæˆå™¨å®¹å™¨ */
        #controls { 
            width: 100%; max-height: 100vh; padding: 15px; background: white; 
            z-index: 2000; box-shadow: 0 2px 15px rgba(0,0,0,0.1); 
            overflow-y: auto; flex-shrink: 0; transition: 0.4s ease-in-out;
        }

        /* å…¬å‘Šæ¬„æ¨£å¼ */
        #bulletin-section { 
            background: #fff9db; border: 1px solid #fab005; border-radius: 12px; 
            padding: 20px; margin-bottom: 15px; font-size: 0.95rem; color: #444; line-height: 1.7;
        }
        #bulletin-section h4 { margin: 15px 0 8px 0; color: #d9480f; font-size: 1.1rem; border-bottom: 2px solid #ffe066; padding-bottom: 5px; }
        #bulletin-section h4:first-child { margin-top: 0; }
        #bulletin-section ul { margin: 10px 0; padding-left: 20px; }
        #bulletin-section li { margin-bottom: 5px; }

        /* ç”Ÿæˆå™¨å€å¡Šæ¨£å¼ (é è¨­éš±è—) */
        #generator-section { display: none; }

        /* åœ°åœ–å€å¡Š */
        #map { flex: 1; height: 0; width: 100%; z-index: 1; background: #e5e5e5; display: none; transition: 0.4s ease-in-out; }
        body.map-visible #map { display: block; height: auto; min-height: 45vh; }
        body.map-hidden #map { display: none !important; }

        /* å…¨è¢å¹•æ¨¡å¼ */
        body.is-fullscreen #controls { max-height: 0; padding: 0; border: none; visibility: hidden; }
        body.is-fullscreen #map { height: 100vh !important; min-height: 100vh !important; display: block !important; }

        /* æŒ‰éˆ•èˆ‡å¡ç‰‡ */
        .card { background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #dee2e6; border-left: 6px solid #2f9e44; }
        .card-y { border-left-color: #fcc419; }
        label { font-weight: bold; font-size: 0.9rem; color: #343a40; display: block; margin-bottom: 5px; }
        textarea { width: 100%; height: 80px; font-size: 14px; border: 1px solid #ced4da; border-radius: 4px; padding: 8px; font-family: monospace; }
        
        button { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-agree { background: #2f9e44; color: white; box-shadow: 0 4px 0 #1e7e34; }
        .btn-agree:active { transform: translateY(3px); box-shadow: none; }
        .btn-view-notice { background: #e9ecef; color: #495057; margin-bottom: 15px; border: 1px solid #ced4da; }
        .btn-gen { background: #2f9e44; color: white; }
        .btn-screen { background: #495057; color: white; display: none; }
        .btn-toggle-map { background: #adb5bd; color: #212529; display: none; }
        .btn-download { background: #1971c2; color: white; display: none; }
        
        #floatingBtn { position: fixed; top: 10px; right: 10px; z-index: 3000; background: rgba(0,0,0,0.7); color: white; border: none; padding: 12px; border-radius: 8px; display: none; font-weight: bold; }
        #status { font-size: 13px; color: #fa5252; text-align: center; margin-top: 8px; font-weight: bold; }

        @media (min-width: 768px) {
            body { flex-direction: row; }
            #controls { width: 450px; height: 100vh; max-height: 100vh; border-right: 1px solid #dee2e6; }
            body.is-fullscreen #controls { width: 0; }
        }
    </style>
</head>
<body id="mainBody">

<button id="floatingBtn" onclick="toggleMapMode()">æ¢å¾©é¢æ¿</button>

<div id="controls">
    <h2 style="margin: 0 0 20px; text-align: center; color: #2f9e44;">çš®å…‹æ•æ”¶æœç¨®èŠ±è·¯å¾‘ç”Ÿæˆå™¨</h2>
    
    <div id="bulletin-section">
        <h4>ğŸ“¢ ç”Ÿæˆå™¨çš„ç”¨é€”èˆ‡ç›®çš„</h4>
        <p>å¤§å®¶éƒ½åœ¨ä¸Šç­ä¹‹é¤˜ç¨®èŠ±è‡ªçµ¦è‡ªè¶³æˆ–æŠ•é¤µæ–°æ‰‹ã€é™¸è»ï¼Œæ²’æœ‰æ™‚é–“ä½¿ç”¨é£›æ©Ÿå…§æ—¢æœ‰çš„æ¨¡å¼ç•«è·¯å¾‘ï¼Œæ‰€ä»¥é€™æ˜¯ä¸€å€‹æ–¹ä¾¿çš®å…‹æ•é£›äººæ”¶æœã€ç¨®èŠ±çš„GPXç”Ÿæˆå™¨ï¼Œä½†è«‹ä¸è¦ç”¨ä¾†ç”¢ç”Ÿåˆ¥äººçš„èŠ±ç”°è·¯å¾‘ç¨®èŠ±ï¼Œè«‹è‡ªå¾‹ç•¶ä¸€å€‹å‹å–„çš„çš®å…‹æ•é£›äººã€‚</p>
        
        <h4>âš ï¸ è«‹éµå®ˆä»¥ä¸‹å¹¾é»ï¼š</h4>
        <ul>
            <li>1.æœ‰èŠ±ç—•çš„ç”° ä¸é–‹ç™¼ ä¸ç”¢ç”Ÿè·¯å¾‘ ä¸å ç‚ºå·±ç”¨</li>
            <li>2.æœ‰é–‹èŠ±çš„ç”°æˆ–æœ‰å›ºå®šç¨®èŠ±ä¸»çš„ç”° åƒ…ç”Ÿæˆæ”¶æœè·¯ç·š åœ¨é–‹å¤§èŠ±æœŸé–“æ‰è·‘è·¯å¾‘æ”¶èŠ±</li>
            <li>3.ç”¢ç”Ÿçš„æª”æ¡ˆéƒ½è«‹è‡ªç”¨ï¼Œä¸è¦åˆ†äº«ï¼Œå°¤å…¶æ˜¯åˆ¥äººç”°çš„è·¯å¾‘æª”</li>
        </ul>

        <h4>ğŸ“¢ ä½¿ç”¨èªªæ˜èˆ‡æé†’</h4>
        <ul>
            <li>1. <b>æ‰‹å‹•è¼¸å…¥ï¼š</b>å°‡åº§æ¨™ä¾åºè²¼å…¥ï¼Œä¸€è¡Œä¸€å€‹ï¼ŒåŸ·è¡Œå¾Œå³å¯ç”Ÿæˆgpxæª”ä¸‹è¼‰ã€‚</li>
            <li>2. <b>ä¸Šå‚³æª”æ¡ˆï¼š</b>å¯ä¸Šå‚³æ—¢æœ‰çš„æ”¶æœè·¯ç·šgpxï¼Œæœƒä¿ç•™åŸæœ¬æª”æ¡ˆçš„è·¯ç·šé †åºï¼Œæ ¹æ“šæ¨¡å¼ç”¢ç”Ÿåœ–å½¢ã€‚</li>
            <li>3. <b>å…¨é »æ¨¡å¼ï¼š</b>é»æ“Šä¸‹æ–¹ã€Œåœ°åœ–å…¨é »ã€å¯ç²å¾—æ›´å¤§é è¦½è¦–é‡ã€‚</li>
            <li>4. <b>åº§æ¨™æŸ¥çœ‹ï¼š</b>é»æ“Šåœ°åœ–<b>ç´…é»</b>å¯é¡¯ç¤ºåº§æ¨™å½ˆçª—æ–¹ä¾¿èª¿æ•´ã€‚</li>
            <li>5. <b>æ‰‹å‹•ä¿®æ­£ï¼š</b>ç”Ÿæˆçš„è·¯ç·šè‹¥ä¸ç¬¦åˆéœ€æ±‚è«‹è‡ªå·±ç”¨å…¶ä»–è»Ÿé«”æ‰‹å‹•ç•«ï¼Œé€™åªæ˜¯æ–¹ä¾¿ç”Ÿæˆï¼Œä¸å¯èƒ½ç¬¦åˆæ‰€æœ‰äººçš„éœ€æ±‚ã€‚</li>
        </ul>
        <button class="btn-agree" onclick="acceptNotice()">å¥½çš„ï¼Œæˆ‘é¡˜æ„éµå®ˆä¸¦ç†è§£</button>
    </div>

    <div id="generator-section">
        <button class="btn-view-notice" onclick="showNotice()">æŸ¥çœ‹å…¬å‘Šèªªæ˜</button>
        
        <button id="toggleMapBtn" class="btn-toggle-map" onclick="manualToggleMap()">éš±è—åœ°åœ–é è¦½</button>
        <button id="screenBtn" class="btn-screen" onclick="toggleMapMode()">åœ°åœ–å…¨é »åˆ‡æ›</button>

        <div class="card">
            <label>1. é¸æ“‡ç”Ÿæˆæ¨¡å¼</label>
            <select id="pathMode" style="width:100%; padding:10px; border-radius:5px;">
                <option value="linear">åº§æ¨™ä¸²æ¥ï¼ˆé©åˆæ”¶æœæˆ–å¤šå¸³ç¨®èŠ±ï¼‰</option>
                <option value="z-shape">Zå­—åœ–å½¢ï¼ˆ2åœˆ&é©åˆç¨®è—ï¼‰</option>
                <option value="square">æ­£æ–¹å½¢è·¯ç·šï¼ˆ2åœˆ&é©åˆç¨®ç™½ï¼‰</option>
            </select>
        </div>

        <div class="card card-y">
            <label>æä¾›åº§æ¨™</label>
            <select id="sourceType" onchange="toggleSource()" style="width:100%; padding:10px; border-radius:5px;">
                <option value="manual">æ‰‹å‹•
